(function(n,c){typeof define=="function"&&define.amd?define([],c):typeof exports=="object"?module.exports=c():n.X2JS=c()})(this,function(){return function(n){var c="1.2.0";n=n||{},M(),j();function M(){n.escapeMode===void 0&&(n.escapeMode=!0),n.attributePrefix=n.attributePrefix||"_",n.arrayAccessForm=n.arrayAccessForm||"none",n.emptyNodeForm=n.emptyNodeForm||"text",n.enableToStringFunc===void 0&&(n.enableToStringFunc=!0),n.arrayAccessFormPaths=n.arrayAccessFormPaths||[],n.skipEmptyTextNodesForObj===void 0&&(n.skipEmptyTextNodesForObj=!0),n.stripWhitespaces===void 0&&(n.stripWhitespaces=!0),n.datetimeAccessFormPaths=n.datetimeAccessFormPaths||[],n.useDoubleQuotes===void 0&&(n.useDoubleQuotes=!1),n.xmlElementsFilter=n.xmlElementsFilter||[],n.jsonPropertiesFilter=n.jsonPropertiesFilter||[],n.keepCData===void 0&&(n.keepCData=!1)}var o={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};function j(){}function y(e){var r=e.localName;return r==null&&(r=e.baseName),(r==null||r=="")&&(r=e.nodeName),r}function S(e){return e.prefix}function m(e){return typeof e=="string"?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function W(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")}function _(e,r,t,l){for(var a=0;a<e.length;a++){var i=e[a];if(typeof i=="string"){if(i==l)break}else if(i instanceof RegExp){if(i.test(l))break}else if(typeof i=="function"&&i(r,t,l))break}return a!=e.length}function O(e,r,t){switch(n.arrayAccessForm){case"property":e[r]instanceof Array?e[r+"_asArray"]=e[r]:e[r+"_asArray"]=[e[r]];break}!(e[r]instanceof Array)&&n.arrayAccessFormPaths.length>0&&_(n.arrayAccessFormPaths,e,r,t)&&(e[r]=[e[r]])}function N(e){var r=e.split(/[-T:+Z]/g),t=new Date(r[0],r[1]-1,r[2]),l=r[5].split(".");if(t.setHours(r[3],r[4],l[0]),l.length>1&&t.setMilliseconds(l[1]),r[6]&&r[7]){var a=r[6]*60+Number(r[7]),i=/\d\d-\d\d:\d\d$/.test(e)?"-":"+";a=0+(i=="-"?-1*a:a),t.setMinutes(t.getMinutes()-a-t.getTimezoneOffset())}else e.indexOf("Z",e.length-1)!==-1&&(t=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())));return t}function P(e,r,t){if(n.datetimeAccessFormPaths.length>0){var l=t.split(".#")[0];return _(n.datetimeAccessFormPaths,e,r,l)?N(e):e}else return e}function w(e,r,t,l){return r==o.ELEMENT_NODE&&n.xmlElementsFilter.length>0?_(n.xmlElementsFilter,e,t,l):!0}function d(e,r){if(e.nodeType==o.DOCUMENT_NODE){for(var t=new Object,l=e.childNodes,a=0;a<l.length;a++){var i=l.item(a);if(i.nodeType==o.ELEMENT_NODE){var s=y(i);t[s]=d(i,s)}}return t}else if(e.nodeType==o.ELEMENT_NODE){var t=new Object;t.__cnt=0;for(var l=e.childNodes,a=0;a<l.length;a++){var i=l.item(a),s=y(i);if(i.nodeType!=o.COMMENT_NODE){var f=r+"."+s;w(t,i.nodeType,s,f)&&(t.__cnt++,t[s]==null?(t[s]=d(i,f),O(t,s,f)):(t[s]!=null&&(t[s]instanceof Array||(t[s]=[t[s]],O(t,s,f))),t[s][t[s].length]=d(i,f)))}}for(var h=0;h<e.attributes.length;h++){var E=e.attributes.item(h);t.__cnt++,t[n.attributePrefix+E.name]=E.value}var v=S(e);return v!=null&&v!=""&&(t.__cnt++,t.__prefix=v),t["#text"]!=null&&(t.__text=t["#text"],t.__text instanceof Array&&(t.__text=t.__text.join("\n")),n.stripWhitespaces&&(t.__text=t.__text.trim()),delete t["#text"],n.arrayAccessForm=="property"&&delete t["#text_asArray"],t.__text=P(t.__text,s,r+"."+s)),t["#cdata-section"]!=null&&(t.__cdata=t["#cdata-section"],delete t["#cdata-section"],n.arrayAccessForm=="property"&&delete t["#cdata-section_asArray"]),t.__cnt==0&&n.emptyNodeForm=="text"?t="":t.__cnt==1&&t.__text!=null?t=t.__text:t.__cnt==1&&t.__cdata!=null&&!n.keepCData?t=t.__cdata:t.__cnt>1&&t.__text!=null&&n.skipEmptyTextNodesForObj&&(n.stripWhitespaces&&t.__text==""||t.__text.trim()=="")&&delete t.__text,delete t.__cnt,n.enableToStringFunc&&(t.__text!=null||t.__cdata!=null)&&(t.toString=function(){return(this.__text!=null?this.__text:"")+(this.__cdata!=null?this.__cdata:"")}),t}else if(e.nodeType==o.TEXT_NODE||e.nodeType==o.CDATA_SECTION_NODE)return e.nodeValue}function u(e,r,t,l){var a="<"+(e!=null&&e.__prefix!=null?e.__prefix+":":"")+r;if(t!=null)for(var i=0;i<t.length;i++){var s=t[i],f=e[s];n.escapeMode&&(f=m(f)),a+=" "+s.substr(n.attributePrefix.length)+"=",n.useDoubleQuotes?a+='"'+f+'"':a+="'"+f+"'"}return l?a+="/>":a+=">",a}function p(e,r){return"</"+(e.__prefix!=null?e.__prefix+":":"")+r+">"}function X(e,r){return e.indexOf(r,e.length-r.length)!==-1}function A(e,r){return!!(n.arrayAccessForm=="property"&&X(r.toString(),"_asArray")||r.toString().indexOf(n.attributePrefix)==0||r.toString().indexOf("__")==0||e[r]instanceof Function)}function F(e){var r=0;if(e instanceof Object)for(var t in e)A(e,t)||r++;return r}function k(e,r,t){return n.jsonPropertiesFilter.length==0||t==""||_(n.jsonPropertiesFilter,e,r,t)}function T(e){var r=[];if(e instanceof Object)for(var t in e)t.toString().indexOf("__")==-1&&t.toString().indexOf(n.attributePrefix)==0&&r.push(t);return r}function L(e){var r="";return e.__cdata!=null&&(r+="<![CDATA["+e.__cdata+"]]>"),e.__text!=null&&(n.escapeMode?r+=m(e.__text):r+=e.__text),r}function b(e){var r="";return e instanceof Object?r+=L(e):e!=null&&(n.escapeMode?r+=m(e):r+=e),r}function g(e,r){return e===""?r:e+"."+r}function U(e,r,t,l){var a="";if(e.length==0)a+=u(e,r,t,!0);else for(var i=0;i<e.length;i++)a+=u(e[i],r,T(e[i]),!1),a+=x(e[i],g(l,r)),a+=p(e[i],r);return a}function x(e,r){var t="",l=F(e);if(l>0){for(var a in e)if(!(A(e,a)||r!=""&&!k(e,a,g(r,a)))){var i=e[a],s=T(i);if(i==null||i==null)t+=u(i,a,s,!0);else if(i instanceof Object)if(i instanceof Array)t+=U(i,a,s,r);else if(i instanceof Date)t+=u(i,a,s,!1),t+=i.toISOString(),t+=p(i,a);else{var f=F(i);f>0||i.__text!=null||i.__cdata!=null?(t+=u(i,a,s,!1),t+=x(i,g(r,a)),t+=p(i,a)):t+=u(i,a,s,!0)}else t+=u(i,a,s,!1),t+=b(i),t+=p(i,a)}}return t+=b(e),t}this.parseXmlString=function(e){var r=window.ActiveXObject||"ActiveXObject"in window;if(e===void 0)return null;var t;if(window.DOMParser){var l=new window.DOMParser,a=null;if(!r)try{a=l.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(i){a=null}try{t=l.parseFromString(e,"text/xml"),a!=null&&t.getElementsByTagNameNS(a,"parsererror").length>0&&(t=null)}catch(i){t=null}}else e.indexOf("<?")==0&&(e=e.substr(e.indexOf("?>")+2)),t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},this.asArray=function(e){return e===void 0||e==null?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():typeof e=="number"?new Date(e).toISOString():null},this.asDateTime=function(e){return typeof e=="string"?N(e):e},this.xml2json=function(e){return d(e)},this.xml_str2json=function(e){var r=this.parseXmlString(e);return r!=null?this.xml2json(r):null},this.json2xml_str=function(e){return x(e,"")},this.json2xml=function(e){var r=this.json2xml_str(e);return this.parseXmlString(r)},this.getVersion=function(){return c}}});